---

- name: Set localtime
  copy:
    remote_src: yes
    src: "/usr/share/zoneinfo/{{ timezone }}"
    dest: "/etc/localtime"

- name: Set timezone
  copy:
    content: "{{ timezone }}\n"
    dest: "/etc/timezone"

- name: Update TimeZone data
  command: dpkg-reconfigure --frontend noninteractive tzdata

- name: Ensure {{ locale }} file exists at source
  stat:
    path: "{{ playbook_dir }}/roles/locales/files/{{ locale }}"
  register: locale_src_file

- debug:
    msg: "{{ locale }} is not defined (file doesn't exist)"
  when: not locale_src_file.stat.exists

- debug:
    msg: "{{ locale }} is defined (file exist)"
  when: locale_src_file.stat.exists is defined and locale_src_file.stat.exists

- name: Copy the {{ locale }} file to {{ locales_dir }}
  copy:
    src: "{{ locale }}"
    dest: "{{ locales_dir }}/{{ locale }}"
    owner: root
    group: root
    mode: 'u=rw,go=r'
  register: locale_file_copy
  when:
    - locale_src_file.stat.exists is defined and locale_src_file.stat.exists

- name: Compile {{ locale }} into {{ format }} format
  command: localedef -f {{ format }} -i {{ locale }} {{ locale_compiled }}
  when: locale_file_copy is succeeded

- name: Set locale to {{ locale }}
  become: false
  command: localectl set-locale LANG={{ locale_compiled }}

- name: Show the day in the Clock indicator
  become: false
  command: gsettings set com.canonical.indicator.datetime show-day true

- name: Show the month and day of month in the Clock indicator
  become: false
  command: gsettings set com.canonical.indicator.datetime show-date true

- name: Change Time from 24hr to 12hr Format
  become: false
  command: gsettings set com.canonical.indicator.datetime time-format '12-hour'

- name: Show the seconds in the Clock indicator
  become: false
  command: gsettings set com.canonical.indicator.datetime show-seconds true

- name: Show monthly calendar in the clock menu
  become: false
  command: gsettings set com.canonical.indicator.datetime show-calendar true

- name: Show time in other locations in the clock menu
  become: false
  command: gsettings set com.canonical.indicator.datetime show-locations true

- name: Add Singapore, Texas, and Toronto locations in the clock menu
  become: false
  command: gsettings set com.canonical.indicator.datetime locations ['UTC UTC', 'Asia/Singapore Singapore', 'America/Chicago Texas City', 'America/Toronto Toronto']
