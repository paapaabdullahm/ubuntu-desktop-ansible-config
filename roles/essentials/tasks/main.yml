---

- name: Ensure the system can use the HTTPS transport for APT
  stat: path=/usr/lib/apt/methods/https
  register: apt_https_transport

- name: Install HTTPS transport for APT
  apt: pkg=apt-transport-https state=installed
  when: not apt_https_transport.stat.exists

- name: Enable all repositories in sources.list
  replace: dest=/etc/apt/sources.list regexp='^#\s?deb(.+)http://(.+)/ubuntu(.+)$' replace='deb\1http://\2/ubuntu\3' backup=yes

- name: Configure GNOME 3 PPA
  apt_repository: repo="ppa:gnome3-team/gnome3" state=present

- name: Ensure that Aptitude repositories are up to date
  apt: update_cache=yes cache_valid_time={{ aptcachetime }}

- name: Install essential packages
  apt: pkg={{ item }} state=latest update_cache=yes cache_valid_time={{ aptcachetime }}
  with_items: "{{ essential_pkgs }}"

- name: Upgrade installed packages
  apt:
    upgrade: yes

- name: Change Swappiness level to 10%
  sysctl:
    name: vm.swappiness
    value: 10
    state: present

- name: Check if battery backup exists for your computer system
  stat:
    path: "/sys/class/power_supply/BAT0/power"
  register: battery_backup

- debug:
    msg: "Battery backup doesn't exist"
  when: not battery_backup.stat.exists

- debug:
    msg: "Battery backup exist"
  when: battery_backup.stat.exists is defined and battery_backup.stat.exists

- name: Specify the action to take when power is critically low
  become: false
  command: gsettings set org.gnome.settings-daemon.plugins.power critical-battery-action 'shutdown'
  when: battery_backup.stat.exists is defined and battery_backup.stat.exists
